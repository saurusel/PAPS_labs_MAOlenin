## Диаграмма системного контекста

На диаграмме системного контекста показана внутрикорпоративная система `Corporate Merch Store`, предназначенная для заказа мерча сотрудниками компании за внутренние поинты с самовывозом.

Выделены следующие роли:

- `Buyer` — сотрудник-покупатель мерча.  
- `Content Admin` — управляет каталогом, категориями и медиа.  
- `Fulfillment Admin` — обрабатывает заказы и статусы выдачи.  
- `Combo Admin` — совмещает права контент-админа и админа выдачи.  
- `Super Admin` — управляет пользователями, ролями и настройками системы.  
- `BI Analyst` — работает с аналитическими отчётами по мерчу.

Все пользовательские роли, кроме BI-аналитика, взаимодействуют с системой `Corporate Merch Store` через веб-интерфейс по HTTPS.

Также показан внешний аналитический контур: данные о заказах, остатках, леджере поинтов и отзывах ежедневно выгружаются в `Google Sheets`, затем попадают в `Google BigQuery` и используются в `Looker Studio` для построения дашбордов, с которыми работает `BI Analyst`.

![C4_Context](../assets/c4_context/C4_Context.svg)

## Диаграмма контейнеров

Диаграмма контейнеров показывает разбиение системы `Corporate Merch Store` на исполняемые части (контейнеры) и их связи.

Внутри системы выделены:

- **Customer Web App** — PWA на React/TypeScript для покупателей (каталог, корзина, заказы, отзывы).  
- **Admin Web App** — SPA на React/TypeScript для администраторов (пользователи, каталог, остатки, заказы, импорты/экспорт, аудит).  
- **Backend API** — модульный монолит на FastAPI (Python), реализующий бизнес-логику и REST API.  
- **Export Worker** — фоновые задачи на Python для экспорта данных в `Google Sheets` и авто-закрытия заказов.  
- **Relational Database (PostgreSQL)** — основное хранилище бизнес-данных.  
- **Cache and Jobs (Redis)** — кэш, сессии и очередь фоновых задач.  
- **File Storage (S3-compatible + CDN)** — хранилище изображений и статических файлов.

Внешние сервисы:

- **Google Sheets / BigQuery / Looker Studio** — цепочка для аналитики и дашбордов.  
- **Sentry** — мониторинг ошибок фронтенда, бэкенда и воркера.  
- **CI/CD Pipeline** — автоматический деплой фронтенда и бэкенда.  
- **Backup Storage** — резервные копии базы данных.

Основные взаимодействия:

- `Buyer` использует `Customer Web App`, администраторы — `Admin Web App`; оба фронтенда обращаются к `Backend API` по REST/JSON через HTTPS.  
- `Backend API` работает с `PostgreSQL`, использует `Redis` и `File Storage`.  
- `Export Worker` берёт задания из `Redis`, читает данные из `PostgreSQL` и выгружает их в `Google Sheets`.  
- Аналитика строится поверх связки `Google Sheets → BigQuery → Looker Studio`.  
- `Sentry`, `CI/CD Pipeline` и `Backup Storage` обеспечивают мониторинг, деплой и отказоустойчивость.

### Обоснование архитектурного стиля

Используется архитектура *клиент–сервер*:

- фронтенды `Customer Web App` и `Admin Web App` (SPA на React);  
- сервер приложений `Backend API` на FastAPI как модульный монолит, разделённый на доменные модули (`auth`, `catalog`, `inventory`, `orders`, `ledger`, `reviews`, `admin`, `imports`, `exports`, `audit`);  
- инфраструктура: `PostgreSQL`, `Redis`, S3-совместимое файловое хранилище.

Такое разбиение упрощает разработку и сопровождение внутрикорпоративной системы и при необходимости позволяет в будущем выделять отдельные домены в самостоятельные сервисы.

![C4_Containers](../assets/c4_containers/C4_Containers.svg)

## Диаграмма компонентов

В работе используются две диаграммы компонентов:

1. Для контейнера **Backend API**
2. Для фронтенда (**Web SPA**)

### Компоненты Backend API

Диаграмма компонентов `Backend API` показывает основные доменные модули серверного приложения:

- **Auth module** — пользователи, роли, аутентификация и авторизация.  
- **Catalog module** — каталог товаров, категории, карточки и медиа.  
- **Inventory module** — остатки по SKU и их корректировки.  
- **Orders module** — создание заказов и управление статусами.  
- **Ledger module** — леджер поинтов (пополнения, списания, возвраты).  
- **Reviews module** — отзывы и рейтинги.  
- **Admin module** — административные операции поверх остальных модулей.  
- **Imports module** — импорт пользователей, остатков и поинтов из CSV.  
- **Exports module** — экспорт данных в `Google Sheets`.  
- **Audit module** — аудит действий администраторов и ключевых операций.

Все модули используют общую базу PostgreSQL. `Orders module` взаимодействует с `Inventory module` и `Ledger module`, `Imports module` и `Exports module` дополнительно используют Redis и интеграцию с `Google Sheets`, а `Audit module` фиксирует важные изменения, проходящие через админский функционал.

![C4_Components_Backend](../assets/c4_components_backend/C4_Components_Backend.svg)

### Компоненты Web SPA

Диаграмма компонентов фронтенда показывает основные области интерфейса:

- **Shell and Auth UI** — каркас приложения, авторизация и навигация.  
- **Catalog and Product UI** — каталог, поиск и карточка товара.  
- **Cart and Checkout UI** — корзина и оформление заказа.  
- **My Orders and Reviews UI** — история заказов и отзывы.  
- **Admin Users UI** — управление пользователями и ролями.  
- **Admin Catalog UI** — управление каталогом и медиа.  
- **Admin Inventory UI** — остатки и их корректировки, запуск импортов.  
- **Admin Orders UI** — очередь заказов и изменение статусов.  
- **Admin Imports and Exports UI** — запуск и мониторинг импортов/экспортов.  
- **Admin Audit UI** — просмотр журнала аудита.

Все компоненты Web SPA обращаются к `Backend API` по HTTPS. Такое разделение упрощает развитие и тестирование отдельных зон интерфейса и позволяет чётко разграничить пользовательские и административные сценарии.

![C4_Components_Frontend](../assets/c4_components_frontend/C4_Components_Frontend.svg)
